<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Избранное</title>
    <link rel="stylesheet" href="./pages/index.css">
</head>
<body class="body">
<header class="header">
    <nav class="nav">
        <div class="nav__container container">
            <ul class="nav__items list">
                <li class="nav__item"><a href="indexAuth.html" class="nav__link link">Рецепты</a></li>
                <li class="nav__item"><a href="myFollow.html" class="nav__link link">Мои подписки</a></li>
                <li class="nav__item"><a href="formRecipe.html" class="nav__link link">Создать рецепт</a></li>
                <li class="nav__item nav__item_active"><a href="favorite.html" class="nav__link link">Избранное</a></li>
                <li class="nav__item"><a href="shopList.html" class="nav__link link">Список покупок</a> <span class="badge badge_style_blue nav__badge" id="counter">4</span></li>
            </ul>
            <ul class="nav__items list">
                <li class="nav__item"><a href="resetPassword.html" class="nav__link link">Изменить пароль</a></li>
                <li class="nav__item"><a href="indexNotAuth.html" class="nav__link link">Выход</a></li>
            </ul>
        </div>
    </nav>
</header>

    <main class="main container">
        <div class="main__header">
            <h1 class="main__title">Избранное</h1>
            <ul class="tags">
                <li class="tags__item">
                    <a id="breakfast" class="tags__checkbox tags__checkbox_style_orange tags__checkbox_active" href="#"></a>
                    <span class="tags__label">Завтрак</span>
                </li>
                <li class="tags__item">
                    <a id="lunch" class="tags__checkbox tags__checkbox_style_green tags__checkbox_active" href="#"></a>
                    <span for="lunch" class="tags__label">Обед</span>
                </li>
                <li class="tags__item">
                    <a id="dinner" class="tags__checkbox tags__checkbox_style_purple tags__checkbox_active" href="#"></a>
                    <label for="dinner" class="tags__label">Ужин</label>
                </li>
            </ul>

        </div>
        <div class="card-list">
            <div class="card" data-id="123">
                <a href="#" class="link" target="_blank"><img src="./images/testCardImg.png" alt="Какой-то текст" class="card__image"></a>
                <div class="card__body">
                    <a class="card__title link" href="#" target="_blank">Французские тосты</a>
                    <ul class="card__items">
                        <li class="card__item"><span class="badge badge_style_green">Обед</span></li>
                        <li class="card__item"><span class="badge badge_style_orange">Завтрак</span></li>
                        <li class="card__item"><span class="badge badge_style_purple">Ужин</span></li>
                    </ul>
                    <div class="card__items card__items_column">
                        <p class="card__text"><span class="icon-time"></span> 20 мин.</p>
                        <p class="card__text"><span class="icon-user"></span> Вероника Чернова</p>
                    </div>
                </div>
                <div class="card__footer">
                    <button class="button button_style_light-blue" name="purchases" data-out><span class="icon-plus button__icon"></span>Добавить в покупки</button>
                    <button class="button button_style_none" name="favorites" data-out><span class="icon-favorite"></span></button>
                </div>
            </div>
            <div class="card" data-id="1241">
                <a href="#" class="link" target="_blank"><img src="./images/testCardImg.png" alt="Какой-то текст" class="card__image"></a>
                <div class="card__body">
                    <a class="card__title link" href="#" target="_blank">Французские тосты</a>
                    <ul class="card__items">
                        <li class="card__item"><span class="badge badge_style_green">Обед</span></li>
                        <li class="card__item"><span class="badge badge_style_orange">Завтрак</span></li>
                        <li class="card__item"><span class="badge badge_style_purple">Ужин</span></li>
                    </ul>
                    <div class="card__items card__items_column">
                        <p class="card__text"><span class="icon-time"></span> 20 мин.</p>
                        <p class="card__text"><span class="icon-user"></span> Вероника Чернова</p>
                    </div>
                </div>
                <div class="card__footer">
                    <button class="button button_style_light-blue" name="purchases" data-out><span class="icon-plus button__icon"></span>Добавить в покупки</button>
                    <button class="button button_style_none" name="favorites" data-out><span class="icon-favorite"></span></button>
                </div>
            </div>
            <div class="card" data-id="1124">
                <a href="#" class="link" target="_blank"><img src="./images/testCardImg.png" alt="Какой-то текст" class="card__image"></a>
                <div class="card__body">
                    <a class="card__title link" href="#" target="_blank">Французские тосты</a>
                    <ul class="card__items">
                        <li class="card__item"><span class="badge badge_style_green">Обед</span></li>
                        <li class="card__item"><span class="badge badge_style_orange">Завтрак</span></li>
                        <li class="card__item"><span class="badge badge_style_purple">Ужин</span></li>
                    </ul>
                    <div class="card__items card__items_column">
                        <p class="card__text"><span class="icon-time"></span> 20 мин.</p>
                        <p class="card__text"><span class="icon-user"></span> Вероника Чернова</p>
                    </div>
                </div>
                <div class="card__footer">
                    <button class="button button_style_light-blue" name="purchases" data-out><span class="icon-plus button__icon"></span>Добавить в покупки</button>
                    <button class="button button_style_none" name="favorites" data-out><span class="icon-favorite"></span></button>
                </div>
            </div>
        </div>
        <nav class="pagination" aria-label="Search results pages">
            <ul class="pagination__container">
                <li class="pagination__item"><a class="pagination__link link" href="#"><span class="icon-left"></span></a></li>
                <li class="pagination__item pagination__item_active"><a class="pagination__link link" href="#">1</a></li>
                <li class="pagination__item"><a class="pagination__link link" href="#">2</a></li>
                <li class="pagination__item"><a class="pagination__link link" href="#">3</a></li>
                <li class="pagination__item"><a class="pagination__link link" href="#">4</a></li>
                <li class="pagination__item"><a class="pagination__link link" href="#">5</a></li>
                <li class="pagination__item"><a class="pagination__link link" href="#"><span class="icon-right"></span></a></li>
            </ul>
        </nav>
    </main>
    <footer class="footer">
        <div class="footer__container container">
            <a href="#" class="footer__brand link">Кулинариум</a>
            <ul class="footer__items">
                <li class="footer__item"><a href="#" class="footer__link link">Об авторе </a></li>
                <li class="footer__item"><a href="#" class="footer__link link">Технологии</a></li>
            </ul>
        </div>
    </footer>
<script src="./js/components/MainCards.js"></script>

<script src="./js/components/Purchases.js"></script>
<script src="./js/components/Favorites.js"></script>

<script src="./js/config/config.js"></script>
<script src="./js/components/CardList.js"></script>
<script src="./js/components/Header.js"></script>

<script src="./js/api/Api.js"></script>
<script src="favorite.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Элементы DOM
    const cardList = document.querySelector('.card-list');
    const tags = document.querySelectorAll('.tags__checkbox');
    const counter = document.getElementById('counter');
    const pagination = document.querySelector('.pagination__container');
    
    // Текущие активные теги
    let activeTags = ['breakfast', 'lunch', 'dinner'];
    // Текущая страница
    let currentPage = 1;
    // Количество рецептов на странице
    const recipesPerPage = 6;
    
    // Загружаем избранные рецепты
    function loadFavoriteRecipes() {
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const allRecipes = JSON.parse(localStorage.getItem('recipes')) || [];
        
        // Фильтруем рецепты, оставляя только избранные
        return allRecipes.filter(recipe => favorites.includes(recipe.id));
    }
    
    // Отображаем рецепты
    function displayRecipes(recipes) {
        cardList.innerHTML = '';
        
        if (recipes.length === 0) {
            cardList.innerHTML = '<p class="empty-message">У вас пока нет избранных рецептов</p>';
            return;
        }
        
        // Применяем пагинацию
        const paginatedRecipes = paginateRecipes(recipes, currentPage, recipesPerPage);
        
        paginatedRecipes.forEach(recipe => {
            const card = createRecipeCard(recipe);
            cardList.appendChild(card);
        });
        
        // Обновляем пагинацию
        updatePagination(recipes.length);
        
        // Инициализируем обработчики событий
        initCardEventHandlers();
    }
    
    // Создаем карточку рецепта
    function createRecipeCard(recipe) {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-id', recipe.id);
        
        // Форматируем теги
        const tagsHTML = [];
        if (recipe.tags.includes('breakfast')) {
            tagsHTML.push('<li class="card__item"><span class="badge badge_style_orange">Завтрак</span></li>');
        }
        if (recipe.tags.includes('lunch')) {
            tagsHTML.push('<li class="card__item"><span class="badge badge_style_green">Обед</span></li>');
        }
        if (recipe.tags.includes('dinner')) {
            tagsHTML.push('<li class="card__item"><span class="badge badge_style_purple">Ужин</span></li>');
        }
        
        card.innerHTML = `
            <a href="singlePage.html?id=${recipe.id}" class="link" target="_blank">
                <img src="${recipe.image}" alt="${recipe.name}" class="card__image" onerror="this.src='./images/default-recipe.jpg'">
            </a>
            <div class="card__body">
                <a class="card__title link" href="singlePage.html?id=${recipe.id}" target="_blank">${recipe.name}</a>
                <ul class="card__items">
                    ${tagsHTML.join('')}
                </ul>
                <div class="card__items card__items_column">
                    <p class="card__text"><span class="icon-time"></span> ${recipe.cooking_time} мин.</p>
                    <p class="card__text"><span class="icon-user"></span> ${recipe.author?.username || 'Автор неизвестен'}</p>
                </div>
            </div>
            <div class="card__footer">
                <button class="button button_style_light-blue" name="purchases" data-out>
                    <span class="icon-plus button__icon"></span>Добавить в покупки
                </button>
                <button class="button button_style_none" name="favorites" data-out="false">
                    <span class="icon-favorite icon-favorite_active"></span>
                </button>
            </div>
        `;
        
        return card;
    }
    
    // Инициализация обработчиков событий для карточек
    function initCardEventHandlers() {
        document.querySelectorAll('.card').forEach(card => {
            const cardId = card.getAttribute('data-id');
            
            // Обработчик для кнопки избранного
            const favoriteBtn = card.querySelector('button[name="favorites"]');
            if (favoriteBtn) {
                favoriteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleFavorite(cardId, favoriteBtn);
                });
            }
            
            // Обработчик для кнопки покупок
            const purchaseBtn = card.querySelector('button[name="purchases"]');
            if (purchaseBtn) {
                purchaseBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    togglePurchase(cardId, purchaseBtn);
                });
            }
        });
    }
    
    // Добавление/удаление из избранного
    function toggleFavorite(cardId, button) {
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const index = favorites.indexOf(cardId);
        
        if (index === -1) {
            favorites.push(cardId);
        } else {
            favorites.splice(index, 1);
        }
        
        localStorage.setItem('favorites', JSON.stringify(favorites));
        
        // Обновляем отображение
        const recipes = loadFavoriteRecipes();
        displayRecipes(recipes);
    }
    
    // Добавление/удаление из покупок
    function togglePurchase(cardId, button) {
        const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
        const index = purchases.indexOf(cardId);
        
        if (index === -1) {
            purchases.push(cardId);
            button.textContent = 'Рецепт добавлен';
            button.classList.add('button_style_light-blue-outline');
            button.setAttribute('data-out', 'false');
        } else {
            purchases.splice(index, 1);
            button.innerHTML = '<span class="icon-plus button__icon"></span>Добавить в покупки';
            button.classList.remove('button_style_light-blue-outline');
            button.setAttribute('data-out', 'true');
        }
        
        localStorage.setItem('purchases', JSON.stringify(purchases));
        updateCounter();
    }
    
    // Обновление счетчика покупок
    function updateCounter() {
        const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
        counter.textContent = purchases.length;
    }
    
    // Фильтрация по тегам
    function filterByTags(tags) {
        const recipes = loadFavoriteRecipes();
        
        if (tags.length === 0) {
            displayRecipes(recipes);
            return;
        }
        
        const filteredRecipes = recipes.filter(recipe => {
            return tags.some(tag => recipe.tags.includes(tag));
        });
        
        displayRecipes(filteredRecipes);
    }
    
    // Пагинация
    function paginateRecipes(recipes, page, perPage) {
        const start = (page - 1) * perPage;
        const end = start + perPage;
        return recipes.slice(start, end);
    }
    
    function updatePagination(totalRecipes) {
        const totalPages = Math.ceil(totalRecipes / recipesPerPage);
        pagination.innerHTML = '';
        
        // Кнопка "Назад"
        const prevItem = document.createElement('li');
        prevItem.className = 'pagination__item';
        prevItem.innerHTML = `<a class="pagination__link link" href="#"><span class="icon-left"></span></a>`;
        prevItem.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage > 1) {
                currentPage--;
                const recipes = loadFavoriteRecipes();
                displayRecipes(recipes);
            }
        });
        pagination.appendChild(prevItem);
        
        // Номера страниц
        for (let i = 1; i <= totalPages; i++) {
            const pageItem = document.createElement('li');
            pageItem.className = `pagination__item ${i === currentPage ? 'pagination__item_active' : ''}`;
            pageItem.innerHTML = `<a class="pagination__link link" href="#">${i}</a>`;
            pageItem.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = i;
                const recipes = loadFavoriteRecipes();
                displayRecipes(recipes);
            });
            pagination.appendChild(pageItem);
        }
        
        // Кнопка "Вперед"
        const nextItem = document.createElement('li');
        nextItem.className = 'pagination__item';
        nextItem.innerHTML = `<a class="pagination__link link" href="#"><span class="icon-right"></span></a>`;
        nextItem.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentPage < totalPages) {
                currentPage++;
                const recipes = loadFavoriteRecipes();
                displayRecipes(recipes);
            }
        });
        pagination.appendChild(nextItem);
    }
    
    // Инициализация страницы
    function initPage() {
        const recipes = loadFavoriteRecipes();
        displayRecipes(recipes);
        updateCounter();
        
        // Обработчики для тегов
        tags.forEach(tag => {
            tag.addEventListener('click', function(e) {
                e.preventDefault();
                this.classList.toggle('tags__checkbox_active');
                
                // Обновление активных тегов
                activeTags = Array.from(tags)
                    .filter(t => t.classList.contains('tags__checkbox_active'))
                    .map(t => t.id);
                
                // Если нет активных тегов, показываем все
                if (activeTags.length === 0) {
                    activeTags = ['breakfast', 'lunch', 'dinner'];
                    tags.forEach(t => t.classList.add('tags__checkbox_active'));
                }
                
                filterByTags(activeTags);
            });
        });
        
        // Обновляем при изменениях в localStorage
        window.addEventListener('storage', function() {
            const recipes = loadFavoriteRecipes();
            displayRecipes(recipes);
            updateCounter();
        });
    }
    
    // Запускаем инициализацию
    initPage();
});
</script>
</body>
</html>
