<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Мои подписки</title>
    <link rel="stylesheet" href="./pages/myFollow.css">
</head>
<body class="body">
<header class="header">
    <nav class="nav">
        <div class="nav__container container">
            <ul class="nav__items list">
                <li class="nav__item"><a href="indexAuth.html" class="nav__link link">Рецепты</a></li>
                <li class="nav__item nav__item_active"><a href="myFollow.html" class="nav__link link">Мои подписки</a></li>
                <li class="nav__item"><a href="formRecipe.html" class="nav__link link">Создать рецепт</a></li>
                <li class="nav__item"><a href="favorite.html" class="nav__link link">Избранное</a></li>
                <li class="nav__item"><a href="shopList.html" class="nav__link link">Список покупок</a><span class="badge badge_style_blue nav__badge" id="counter">4</span></li>

            </ul>
            <ul class="nav__items list">
                <li class="nav__item"><a href="resetPassword.html" class="nav__link link">Изменить пароль</a></li>
                <li class="nav__item"><a href="indexNotAuth.html" class="nav__link link">Выход</a></li>
            </ul>
        </div>
    </nav>
</header>
<main class="main container">
    <div class="main__header">
        <h1 class="main__title">Мои подписки</h1>
    </div>
    <div class="card-list">
        <div class="card-user" data-author="700">
        <div class="card-user__header">
            <h2 class="card-user__title">Вероника Чернова</h2>
        </div>
        <div class="card-user__body">
            <ul class="card-user__items">
                <li class="card-user__item">
                    <div class="recipe">
                        <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                        <h3 class="recipe__title">Французские тосты</h3>
                        <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                    </div>
                </li>
                <li class="card-user__item">
                    <div class="recipe">
                        <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                        <h3 class="recipe__title">Французские тосты</h3>
                        <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                    </div>
                </li>
                <li class="card-user__item">
                    <div class="recipe">
                        <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                        <h3 class="recipe__title">Французские тосты</h3>
                        <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                    </div>
                </li>
                <li class="card-user__item">
                    <a href="#" class="card-user__link link">Еще 7 рецептов...</a>
                </li>
            </ul>
        </div>
        <div class="card-user__footer">
            <button class="button button_style_light-blue button_size_auto" name="subscribe">Отписаться</button>
        </div>
    </div>
        <div class="card-user" data-author="707">
            <div class="card-user__header">
                <h2 class="card-user__title">Вероника Чернова</h2>
            </div>
            <div class="card-user__body">
                <ul class="card-user__items">
                    <li class="card-user__item">
                        <div class="recipe">
                            <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                            <h3 class="recipe__title">Французские тосты</h3>
                            <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                        </div>
                    </li>
                    <li class="card-user__item">
                        <div class="recipe">
                            <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                            <h3 class="recipe__title">Французские тосты</h3>
                            <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                        </div>
                    </li>
                    <li class="card-user__item">
                        <div class="recipe">
                            <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                            <h3 class="recipe__title">Французские тосты</h3>
                            <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                        </div>
                    </li>
                    <li class="card-user__item">
                        <a href="#" class="card-user__link link">Еще 7 рецептов...</a>
                    </li>
                </ul>
            </div>
            <div class="card-user__footer">
                <button class="button button_style_light-blue button_size_auto" name="subscribe">Отписаться</button>
            </div>
        </div>
        <div class="card-user" data-author="7091">
            <div class="card-user__header">
                <h2 class="card-user__title">Вероника Чернова</h2>
            </div>
            <div class="card-user__body">
                <ul class="card-user__items">
                    <li class="card-user__item">
                        <div class="recipe">
                            <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                            <h3 class="recipe__title">Французские тосты</h3>
                            <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                        </div>
                    </li>
                    <li class="card-user__item">
                        <div class="recipe">
                            <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                            <h3 class="recipe__title">Французские тосты</h3>
                            <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                        </div>
                    </li>
                    <li class="card-user__item">
                        <div class="recipe">
                            <img src="./images/testCardImg.png" alt="какой-то-текст" class="recipe__image">
                            <h3 class="recipe__title">Французские тосты</h3>
                            <p class="recipe__text"><span class="icon-time"></span> 20 мин.</p>
                        </div>
                    </li>
                    <li class="card-user__item">
                        <a href="#" class="card-user__link link">Еще 7 рецептов...</a>
                    </li>
                </ul>
            </div>
            <div class="card-user__footer">
                <button class="button button_style_light-blue button_size_auto" name="subscribe">Отписаться</button>
            </div>
        </div>
    </div>
    <nav class="pagination" aria-label="Search results pages">
        <ul class="pagination__container">
            <li class="pagination__item"><a class="pagination__link link" href="#"><span class="icon-left"></span></a></li>
            <li class="pagination__item pagination__item_active"><a class="pagination__link link" href="#">1</a></li>
            <li class="pagination__item"><a class="pagination__link link" href="#">2</a></li>
            <li class="pagination__item"><a class="pagination__link link" href="#">3</a></li>
            <li class="pagination__item"><a class="pagination__link link" href="#">4</a></li>
            <li class="pagination__item"><a class="pagination__link link" href="#">5</a></li>
            <li class="pagination__item"><a class="pagination__link link" href="#"><span class="icon-right"></span></a></li>
        </ul>
    </nav>
</main>
<footer class="footer">
    <div class="footer__container container">
        <a href="#" class="footer__brand link">Кулинариум</a>
        <ul class="footer__items">
            <li class="footer__item"><a href="#" class="footer__link link">Об авторе </a></li>
            <li class="footer__item"><a href="#" class="footer__link link">Технологии</a></li>
        </ul>
    </div>
</footer>
<script src="./js/config/config.js"></script>
<script src="./js/components/MainCards.js"></script>
<script src="./js/components/MyFollow.js"></script>
<script src="./js/components/Subscribe.js"></script>
<script src="./js/components/Header.js"></script>
<script src="./js/api/Api.js"></script>
<script src="myFollow.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Элементы DOM
        const cardList = document.querySelector('.card-list');
        const counter = document.getElementById('counter');
        const pagination = document.querySelector('.pagination__container');
        
        // Текущая страница
        let currentPage = 1;
        
        // Класс для работы с подписками
        class MyFollow {
            constructor(container) {
                this.container = container;
                this.authors = Array.from(container.querySelectorAll('.card-user'));
                this.subscriptions = JSON.parse(localStorage.getItem('subscriptions')) || [];
                this.setupEventListeners();
                this.setupPagination();
                this.updateSubscriptions();
            }
            
            // Настройка обработчиков событий
            setupEventListeners() {
                this.authors.forEach(author => {
                    const authorId = author.getAttribute('data-author');
                    
                    // Обработчик для кнопки отписки
                    const unsubscribeBtn = author.querySelector('button[name="subscribe"]');
                    unsubscribeBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.toggleSubscription(authorId);
                    });
                    
                    // Обработчик для ссылки "Еще рецепты"
                    const moreRecipesLink = author.querySelector('.card-user__link');
                    if (moreRecipesLink) {
                        moreRecipesLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            window.location.href = `authorRecipe.html?id=${authorId}`;
                        });
                    }
                    
                    // Обработчики для кликов по рецептам автора
                    const recipes = author.querySelectorAll('.recipe');
                    recipes.forEach(recipe => {
                        recipe.addEventListener('click', (e) => {
                            e.preventDefault();
                            const recipeId = recipe.closest('.card-user__item').getAttribute('data-id') || '123'; // Временное решение
                            window.location.href = `singlePage.html?id=${recipeId}`;
                        });
                    });
                });
            }
            
            // Настройка пагинации
            setupPagination() {
                const pageLinks = pagination.querySelectorAll('.pagination__link');
                
                pageLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        
                        // Обработка стрелок
                        if (link.querySelector('.icon-left')) {
                            this.goToPage(currentPage - 1);
                        } else if (link.querySelector('.icon-right')) {
                            this.goToPage(currentPage + 1);
                        } else {
                            const pageNum = parseInt(link.textContent);
                            if (!isNaN(pageNum)) {
                                this.goToPage(pageNum);
                            }
                        }
                    });
                });
            }
            
            // Переход на указанную страницу
            goToPage(page) {
                if (page < 1 || page > 5) return;
                
                currentPage = page;
                
                // Обновление активной страницы в пагинации
                const pageItems = pagination.querySelectorAll('.pagination__item');
                pageItems.forEach(item => {
                    item.classList.remove('pagination__item_active');
                    if (item.textContent == currentPage) {
                        item.classList.add('pagination__item_active');
                    }
                });
                
                // Прокрутка к верху страницы
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                console.log(`Переход на страницу ${currentPage}`);
                // Здесь можно добавить загрузку данных для новой страницы
            }
            
            // Добавление/удаление подписки
            toggleSubscription(authorId) {
                const index = this.subscriptions.indexOf(authorId);
                if (index === -1) {
                    this.subscriptions.push(authorId);
                } else {
                    this.subscriptions.splice(index, 1);
                }
                localStorage.setItem('subscriptions', JSON.stringify(this.subscriptions));
                this.updateSubscriptions();
                
                // Если отписались, перезагружаем страницу
                if (index !== -1) {
                    location.reload();
                }
            }
            
            // Обновление состояния подписок
            updateSubscriptions() {
                this.authors.forEach(author => {
                    const authorId = author.getAttribute('data-author');
                    const subscribeBtn = author.querySelector('button[name="subscribe"]');
                    
                    if (this.subscriptions.includes(authorId)) {
                        subscribeBtn.textContent = 'Отписаться';
                        subscribeBtn.classList.remove('button_style_blue');
                        subscribeBtn.classList.add('button_style_light-blue');
                    } else {
                        subscribeBtn.textContent = 'Подписаться';
                        subscribeBtn.classList.remove('button_style_light-blue');
                        subscribeBtn.classList.add('button_style_blue');
                    }
                });
            }
        }
        
        // Инициализация подписок
        const myFollow = new MyFollow(cardList);
        
        // Обновление счетчика покупок
        function updateCounter() {
            const purchases = JSON.parse(localStorage.getItem('purchases')) || [];
            counter.textContent = purchases.length;
        }
        
        updateCounter();
    });
</script>

</body>
</html>
